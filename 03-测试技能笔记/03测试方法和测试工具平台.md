# 测试基础

## 1 什么是测试？

参考文章[新人落地指南] ：https://www.atatech.org/articles/146249?spm=ata.13269325.0.0.6caa49faxkIavO#29

### 1.1 什么是质量？

质量的定义因领域不同定义有很多说法，软件领域的质量是指在特定的使用条件下产品满足明示的和隐含的需求所明确具备能力的全部固有特性（内在特性），体现了产品满足产品要求的程度（外部表现），是产品的质量属性。

从概念分析对应到我们实际的测试工作，包括的三个要素：产品（我们的被测对象）、特性集合（需要采用哪些测试类型）、需求（覆盖的测试场景）。

### 1.2 什么是测试？

我们技术质量做的一切活动目的，一定是为了保障业务交付。测试要打造发现问题的能力，同样也需要有打造高稳定性的能力。需要对每次发现的问题都剖析如何能避免问题再次发生或更早阶段识别，同时对遗漏的问题都深入思考剖析为什么没能提前发现。围绕这样的目的作为我们工作的方向。

### 1.3 准备环境

项目

日常

预发

灰度

生产（线上）

![16_48_11__07_10_2019.jpg](https://intranetproxy.alipay.com/skylark/lark/0/2019/jpeg/127700/1562748517423-e367fe15-f179-4919-80e3-3f3037a7d2b4.jpeg)

## 2 工具平台

**具体见下文具体测试方法中涉及到的平台**

鹰眼：日志链路分析

iDB：数据库测试

HSF-ODPS：接口测试

DataStudio：数据库测试

摩天轮：

disguiser：mock接口返回

ATS：客户端抓包



## 3 测试流程

![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/68200/1562679339242-195139db-6eb1-470c-a489-5e2615086e38.png)

**需求评审：**

了解需求业务目标和实现逻辑，为开发设计、测试设计做准备；

识别需求设计阶段问题

通过评审尽可能降低团队成员理解的不一致性

评估风险、在需求阶段纳入风险防控

**测试分析：**

从资源、业务要求角度设计测试完成所需计划。明确测试范围，测试目标，测试重点和难点，测试深度和广度，如何安排测试工作节奏，测试如何分层等

**监控梳理：**

从业务需求梳理业务监控点和风险点

**执行测试：**

冒烟测试

测试执行阶段

**发布：**

注意发布计划，回滚计划、预案开关

> **以投资人智能助理为例，发布计划如下：**
>
> **接口发布（16日）**
>
> ​	common打client包
>
> ​	common更改diamond配置（新增自适应场景com.taobao.auctioncommon.subscribe）
>
> ​	common发布
>
> ​	ap升级commonclient版本
>
> ​	ap新增diamond配置（搜索条件适配的配置com.taobao.ap.config.subscribe.autoadapt）
>
> ​	ap发布
>
> ​	小蜜发布
>
> ​	线上测试
>
> **入口发布（17日）**
>
> ​	ga打client包
>
> ​	ga发布
>
> ​	gd升级gaclient
>
> ​	gd更改diamond配置（vip和非vip的入口类目的配置com.taobao.govdetail.config.common）
>
> ​	gd发布
>
> ​	配置测试账号信息
>
> ​	使用测试账号线上验证
>
> ​	打开开关，开放入口（*SHOW_VIP_DISPLAY_INFO）*
>
> ​	使用非测试账号线上验证
>
> **紧急刹车方案**
>
> ​	关闭入口开关（*SHOW_VIP_DISPLAY_INFO）*

## 4 测试分析

### 什么是测试场景？

测试场景就是对这类事件触发时的业务情景在质量角度的描述。

测试用例是对测试场景在测试范围和测试点的详细覆盖。

### 测试分析可总结为四步

- 建模 - 输出业务/系统流程（分析：业务流程 - 系统流程）
- 设计 - 测试场景（设计：测试场景）
- 细分 - 测试用例/数据（设计：测试用例）
- 扩展 - 多类型测试（性能，安全，经验。。。）（基于经验）

![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/68200/1563124051892-4fdf9a78-5675-47a3-9e5d-03a632067801.png)

测试用例的设计很多时候是测试数据设计的过程，根据事件流（基本流+备选流）和数据，根据不同的角色。进行用例覆盖。需要确保所有场景100%覆盖。

测试用例在设计上除了考虑功能性质量属性，还需要对非功能性进行覆盖，推荐一个四字法进行设计。

- 多：针对测试用例进行大数据量覆盖测试
- 并：针对测试用例进行大数据量同时执行，验证并发下的测试结果
- 复：重复的参数对同一用例进行执行测试。验证幂等结果是否符合预期。
- 异：用非正常输入值进行用例测试。验证结果的正确性。

## 5 测试范围和方法

**功能性**、**性能效率**、兼容性、**易用性**、**可靠性**、信息安全性、可维护性和可移植性

![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/68200/1562573797124-2fd51da2-3077-4525-b71b-8f97ac03757f.png)

**产品质量特性说明：**

- <u>**功能性** - 在指定条件下使用时,产品或系统提供满足明确和隐含要求的功能的程度</u>。包括功能完备性、功能正确性、功能适合性、功能性的依从性。
- <u>**性能效率** - 性能效率的评估与在指定条件下所使用的资源量有关。</u>包括时间特性、资源利用率、容量、性能效率的依从性。我们日常的常态压测、大促的全链路压测等都是这一质量属性的测试体现。
- <u>**可靠性** - 系统、产品或组件在指定条件下、指定时间内执行指定功能的程度。</u>包括成熟性、可用性、容错性、易恢复性、可靠性的依从性。质量同学在评估方案时经常会出现这样的灵魂拷问：怎样设计测试场景保障线上不出问题、如何设计架构让主流程不受阻塞、强弱依赖如何解耦、准备怎样的预案让问题发生时也能快速恢复等，都是对可靠性质量属性的测试实践。
- <u>**易用性** - 在指定的使用周境中,产品或系统在有效性、效率和满意度特性方面为了指定的目标可为指定用户使用的程度。</u>包括可辨识性、易学性、易操作性、人工差错防御性、易访问性、易用性的依从性。易用性的另一个描述就是功能级别的用户体验（下一章会介绍使用级别的用户体验），我们新零售技术质量的愿景就是“做用户体验的捍卫者”，因此易用性是测试过程中很重要的一个覆盖范围。易用性里核心需关注的是人工差错防御，我们有很多故障或线上问题都来自于人工操作或配置类错误，这都是人工差错防御范围。
- 兼容性 - 在共享相同的硬件或软件环境的条件下,产品、系统或组件能够与其他产品、系统或组件交换信息,和/或执行其所需的功能的程度。包括共存性、互操作性、兼容性的依从性。兼容性测试在移动应用测试和跨平台组件应用上需着重评估。
- 信息安全性 - 产品或系统保护信息和数据的程度,以使用户、其他产品或系统具有与其授权类型和授权级别一致的数据访问度。包括保密性、完整性、抗抵赖性、可核查性、真实性、信息安全的依从性。这部分质量属性直接对应安全性测试，已经是测试领域里独立的一个重要方向。
- 可维护性 - 产品或系统能够被预期的维护人员修改的有效性和效率的程度。包括模块化、可重用性、易分析性、易修改性、易测试性、维护性依从性。可维护性更多体现在对设计方案的评估过程中。
- 可移植性 - 系统、产品或组件能够从一种硬件、软件、或者其他运行(或使用)环境迁移到另一种环境的有效性和效率的程度。包括适应性、易安装性、易替换性、可移植性的依从性。迁移类项目和版本升级类变更需评估。

![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/68200/1562596088878-563f652c-feca-403a-8d4a-c556b6022f2d.png)

### 无线测试

**可靠性测试**

- 压力测试：通过对CPU、内存、存储等加压，确认是否有功能、性能和稳定性问题。
- 中断测试：中断测试指运行中被其他任务或意外事件等情况终止退出，相应的测试即为中断测试。中断测试有人为中断，新任务中断，以及意外中断等几种情况，通过中断测试，确认App的恢复情况。

**移动应用测试方法**

- 真机测试：摩天轮([http://mtl3.alibaba-inc.com/](http://mtl3.alibaba-inc.com/?spm=ata.13261165.0.0.145476d1DVGxkA))找到对应的安装包，通过扫码方式进行安装，执行对应的测试。

- 模拟测试：mock测试就是在测试过程中，对于某些不容易构造或者不容易获取的对象，用一个虚拟的对象来创建以便测试的测试方法。

  - mock工具：[disguiser](http://mobile.tmall.net/rocket/test_case.html)

- 流量测试：目前的网络类型包含2G\3G\4G\wifi，其中还有不同运营商的区分，我们在APP的使用中经常遇到大资源，重复请求，调用响应慢，调用失败等各种情况。在不同的网络类型之下，我们不仅要**控制流量使用，还需要加快请求的响应。**
  流量测试可以给我们带来什么？

  1.可以让我们很清楚的知道用户在某种场景下使用我们的产品需要消耗多少流量。

  2.流量数据分析可以指导我们去做优化；比如cgi的调用和参数设置是否合理，有些资源或者配置是否可以本地化？

  3.流量的优化可以带来速度的优化；减少tcp数据包的个数，或者直接减少请求数都可以带来速度的优化。

- 弱网测试：弱网测试主要在宽带、丢包、延时的弱网环境中，验证客户端的展示、以及丢包、延时的处理机制，确认是否有功能、性能和稳定性问题。

- 耗电测试：App使用过程中的电量测试，慎重检查App的电量使用，以免导致用户手机耗电发热，带来不良体验。

- 性能测试：性能测试主要关注：CPU、内存、FPS和响应时间。

- 适配测试：移动端兼容性测试，主要测试App在Android不同的设备OPPO、VIVO、HUAWEI等设备，在Android不同的系统4.X、5.X、6.X、7.X、8.X等系统的兼容性，确认是否有功能、性能和稳定性问题；App在iOS不同的设备iPhone6、iPhone7、iPhoneX等设备，在iOS不同的系统9.X、10.X、11.X、12.X、13.X等系统的兼容性，确认是否有功能、性能和稳定性问题。

### 服务端测试

- 一种是直接对WEB或者APP的API接口进行测试；
- 另一种是对更后端的数据库、缓存系统、中间件、文件系统等进行测试，核心就是输入输出是否符合服务设计。
- 必备的测试手段包括接口测试、性能测试、稳定性测试、异常测试。
  - 稳定性测试中涉及：异常、超时、重试幂等、性能等

## 6 测试基本原则



# 精准测试

**精准测试**

参考文档：

[精准测试之代码变更](https://www.atatech.org/articles/73456?spm=ata.13261165.0.0.24e6437dVi8V6F)

[精准测试之功能测试覆盖率统计](https://www.atatech.org/articles/73342?spm=ata.13261165.0.0.a46e1d0ecs4FzG#4)

### 代码变更

**目的**

查找本次需求代码分支的所有代码变更。

通过代码改动评估本次变更所涉及的功能增、删、改，以及对原有功能的影响。

确认回归范围。

**实现**

SVNKit是一套开源的java API，可以通过java实现svn的更新、上传、代码比对等操作。

用户可以在不拉取代码的情况下，对比分支和主干的代码变更。只要在aone上查询到分支名，就可以获取分支代码变更文件的列表。

### 代码覆盖率

结合分支代码变更，来查看变更代码的测试覆盖情况，可以更加有针对性的测试。
在第一阶段测试完成后，查看代码变更部分的覆盖情况，并根据未覆盖的代码补充测试用例。
然后进行第二阶段测试，再次收集覆盖率情况，查看是否充分测试。

### ATP

#### 入口：日志链路

http://paimai-test.taobao.net/#/measurement/branchAnalysis

- 变更分析
- 回归报告
- 增量覆盖率
- 覆盖率报告
- 错误日志
- 日志查询
- 标签管理

#### 1.1 代码覆盖率测试

代码覆盖（Code coverage）是软件测试中的一种度量，描述程式中源代码被测试的比例和程度，所得比例称为代码覆盖率。



# 埋点测试

### 1、参考资料

#### 1.1、平台工具

A+：http://aplus.alibaba-inc.com/aplus/page.htm?spm=a1z3g.7759408.0.0.325bc83aO5PInq&pageId=170&id=w-a2129.1122572

fbi：https://fbi.alibaba-inc.com/fbi/site/page.htm?id=2703&menuId=1546498336623

埋点治理平台：https://usertrack.alibaba-inc.com/validate/qrcode

#### 1.2、参考文档

[埋点规范和埋点测试方法简析-笑总](https://www.atatech.org/articles/69837)

两大类：SPM和黄金令箭



### 2、spm

#### 2.1、是什么

[SPM规范详细介绍](http://log.alibaba-inc.com/log/info.htm?spm=ata.13261165.0.0.38171bf44DqUhw&type=2392)

**【简介】：**

阿里日志采用了一个页面定位模型(SPM), 来记录和描述用户的具体点击位置信息. 

​		—— 不只到页面级别

​	简单而言, 当用户点击页面上的一个链接时, 日志系统就会为该位置赋予一个唯一的编码(SPM位置编码), 这个SPM将被写入到目标页面的URL内. 如此一来, 通过观察目标页面PV日志中的url, 即可推算出本次PV到底来自哪个前续页面的哪个位置. 

**【四段分别代表什么？】**

阿里的SPM位置编码由A.B.C.D四段构成, 各分段分别代表 

// spm=spmA.spmB.spmC.spmD.spmE    

spmA 唯一标识一个站点/业务，如拍卖
spmB 唯一标识某站点的一个页面，如拍卖首页
spmC 唯一标识某页面的一个区块，如话题推荐区块
spmD 唯一标识某区块的一个具体位置，如某个话题的banner链接
spmE 随机生成的字串，跟时间有关系，在循环页面计算时可以区分点击的时序

![upFile](http://img01.taobaocdn.com/poster/i1/TB1CxqaNXXXXXX3aXXXSutbFXXX_670x670)

**投资人助理埋点需求：**

> ‘&spm=a2129.7389955.vipChat.i2&pvid=8601400023_1571106357188
>
> 站点/业务id：a2129
>
> 页面id：7389955
>
> 区块id：vipChat
>
> **看链接**

#### 2.2、用来做什么？

主要用作PV(用户访问次数)/UV(独立访客个数)统计。

- A＋流量分析产品内的所有计算均基于SPM，只有埋点SPM成功的页面，方可在A＋中分析数据。

### 3、黄金令箭

#### 1 使用场景

- SPM的弊端：

  ​		对于多tab切换等异步加载场景采集中，默认情况下, 页面只有第一次进入时会全局刷新，也就是说只有第一次进入时会有一个日志请求（1个PV），后继切换操作都不会产生PV，这给业务的数据带来不可分析性。

- 对于此类场景, aplus提供对应的接口和方法, 实现由应用前端在页面刷新后, 自主发送PV日志. —— 黄金令箭

- 一般而言，如果业务需要采集非页面浏览之外的日志，就可以使用黄金令箭，在阿里内部，一般的典型场景如下：

  - 页面元素曝光 日志采集
  - 用户在页面上不切换页面的交互行为（点击/滑动/触摸等）日志采集
  - 非界面化的后台接口/服务调用日志采集
  - 桌面程序的功能/按钮点击日志采集

##### 1.1 用来做什么？

常用的几种场景：

1、曝光统计

2、点击统计

3、个性化内容投放

#### 怎么测？

看请求

**【举例】：**

举个例子，打开h5页面，查看elements，最上面就可以看到data-spm

![image-20190908133148911](/Users/baola/Library/Application Support/typora-user-images/image-20190908133148911.png)

每次点击该button，会调用一次tbauctionh这个请求

![image-20190908133602724](/Users/baola/Library/Application Support/typora-user-images/image-20190908133602724.png)



### 4、SCM -- 算法埋点

参考文档：

[聚划算-埋点scm简介](https://www.atatech.org/articles/47273?spm=ata.13269325.0.0.6b7149faW4T3mJ)

[阿里日志-SCM详细介绍](http://log.alibaba-inc.com/log/info.htm?spm=ata.13261165.0.0.38171bf44DqUhw&type=2395&id=17)

#### 1 是什么

SCM编码：用来跟踪内容的编码，我们说的内容是指由投放系统或者市场部，运营小二等在页面上推广的一个链接，一个图片或者一个素材。

同样的，scm编码也采用a.b.c.d的格式，其中，一般来说，

a 标识投放系统ID，用来标识不同的内容投放方，比如商城的阿拉丁系统，对应的投放系统ID为1003。

b 标识投放算法ID，用来标识投放系统产生不同内容的投放算法。

c 标识投放算法版本ID，用来标识投放算法的不同版本。

d 标识投放人群ID，用来标识不同的投放人群，或者对接profile。

#### 2 用来做什么

完整的SCM编码同样的能够唯一的记录这条内容产生的具体投放方和细节。

个性化投放时跟算法系统对接经常需要用到，比如大促会场楼层标签会场的个性化投放。

#### 3 应用：和SPM结合

根据链接中spm和scm的组合，我们就能追踪到这条链接，是由什么内容提供方提供的，并且由用户在哪个指定页面的指定位置点击产生的。通过spm和scm的组合效果评估，我们就能知道什么位置投放什么内容效果最好，什么样的内容投放在什么位置效果最佳，从而达到将合适的内容推送到合适的位置的效果。

**投资人助理埋点需求：**

> &scm=20140647.0.alime_viewer.0.7389955.vipChat.i2&path=7389955 ’
>
> 1. 平台id：20140647
> 2. 站点id：0
> 3. 页面id：alime_viewer/alime_vip/alime_bidder
> 4. 



### 怎么进行埋点测试？

见[埋点规范和埋点测试方法简析-笑总](https://www.atatech.org/articles/69837)——5 埋点测试方法



# 前端性能

- 前端性能优化白皮书：https://yuque.antfin-inc.com/experience-optimization/fed_perf_paper
- 性能指标：https://yuque.antfin-inc.com/experience-optimization/fed_perf_paper/perf-std

- weex analyzer使用文档：https://yuque.antfin-inc.com/weex_analyzer/document/ffll5u
- 性能指标和测试方法：https://www.atatech.org/articles/96882 

### 常见的几种App开发模式

（weex、native、h5等）

![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/224970/1564625519268-d39ec11c-7b33-430e-b3b0-2a4f5babafdf.png?x-oss-process=image/resize,w_1500)



首先是三种比较经典的：

#### 1、Native App(原生APP开发模式)：

Native App开发即我们所称的传统APP开发模式，该开发针对IOS(`OC`或者`swift`)、Android(`Java`或者`kotlin`)等不同的手机操作系统要采用不同的语言和框架进行开发，是专门针对某一类移动设备而生的，它们都是被直接安装到设备里， APP应用所有的UI元素、数据内容、逻辑框架均安装在手机终端上。

- 优点:
  1.可轻易调用手机所有硬件实现功能
  2.速度更快、性能高、整体用户体验最好
  3.质量安全性很高
- 缺点：
  1.开发周期长及维护成本高(比如ios和android需2端开发2个app)
  2.学习成本高(ios必须会swift，android必须会Java)

#### 2、Web App(HTML5 APP 框架开发模式):

Web App即我们通常所说的H5 app，主要通过HTML，CSS，JS构建页面，然后发布到服务器，用户通过手机网络访问这些页面。类似微信公众号等。

- 优点:
  1.项目独立，维护更容易，兼容多平台
  2.开发周期短，学习成本低
  3.更新发版更容易
- 缺点：
  1.体验不好，对设备和网络要求高，经常卡顿，性能差
  2.无法调用系统硬件

#### 3、Hybrid App(混合模式移动应用):

Hybrid App是指介于Web App、Native App这两者之间的app， Hybrid App主要以JS+Native两者相互调用为主，从开发层面现“一次开发，多处运行”的机制，成为真正适合跨平台的开发，是目前乃至未来发展的趋势。

- 优点:
  1.维护容易，能调用部分系统硬件，兼容多平台
  2.开发周期短，学习成本低
- 缺点：
  1.可能需要会原生开发以支持更多的硬件调用
  2.性能跟原生还是有差距，对设备有一定要求

上图中的React Native和weex都属于混合模式移动应用开发框架。

##### 3.1 reactive native

React Native是Facebook 开源的跨平台移动应用开发框架，使用JavaScript编写原生移动应用，通过声明式的组件机制来搭建丰富多彩的用户界面。React Native 经过 3 年多的发展，已经比较成熟，虽然至今没有发布 1.0 版本，但其社区很活跃。

React Native所使用的基础UI组件和原生应用完全一致。 基础组件使用JavaScript和React的方式组合起来。

##### 3.2 weex 

Weex 集成了 WeexSDK 之后，可以使用 JavaScript 和现代流行的前端框架来开发移动应用，使用同一套代码来构建 Android、iOS 和 Web 应用。目前主要支持 Vue.js和 Rax这两个前端框架。起步比较晚，社区没有 React Native 活跃，资料和开源项目也相对较少。

缺点：文档，主要有阿里人员来维护

**无线端页面的话，阿里采用比较多的就是H5和weex。**

### 前端性能指标


​      之前多端性能指标不统一，例如 weex 的可交互时间叫法实际是 native 的渲染时长，是 web 下的首屏渲染完成时间。现经过 Native 架构组性能代表、Weex 性能代表、淘宝和天猫业务性能代表讨论，Native、Weex、Web 多端的性能指标已统一为首屏时间、可交互时间这几个指标。

先介绍

#### 0、页面渲染的过程

![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/224970/1565281151252-a3adc737-40d4-4439-96f0-b9ef81fd90d1.png)

我们关注的几个性能指标，加了星号

#### 1、加载性能

##### 1.1  js budle加载时间✨

- js bundle是什么？

webpack可以打包得到bundle.js文件，具体工作是：1.分析得到所有必须模块并合并。2.提供让这些模块有序，正常的执行环境。总结一下，就是先创建一个容器，然后去检查传入的参数函数是否已经在容器中，确定不在之后，在将它放入到容器中，方便以后调用。

- 定义：

一般来说的加载时间就是指**js bundle的加载时间**（从网络下载或本地加载）

#### 2、渲染性能

##### 2.1 首屏时间

英文名： first-screen-paint（FSP）

定义： 从开始加载（navigationStart）到**首屏内容全部渲染完成**。

另一种说法：Weex 页面开始渲染到第一个超出首屏元素渲染完成的时间

浏览型页面：

- 首屏时间：<= 2000ms

互动游戏类页面：

- 首屏时间：<= 3500ms 

##### 2.2 可交互时间✨

英文名：time-to-interactive（TTI）

定义：从开始加载（navigationStart）到屏幕首屏全部渲染完成，**渲染完成后并且在持续 5s 内无 long task 卡顿**。

##### 2.3 可流畅交互时间

英文名：time-to-interactive-fluent（TTIF）

定义： 从开始加载（navigationStart）到屏幕首屏全部渲染完成，**渲染完成并且页面可连续滚动 3 次**。

浏览型页面：

- 可流畅交互时间：<= 3000ms

互动游戏类页面：

- 可流畅交互时间：<= 4500ms（如果页面超过 1 屏）

#### 3、内存✨

针对不同的终端和页面类型，我们制定了不同的内存标准

- Android

- - 没有视频内容

- - - 单页整体内存不超过 50M
    - Native heap 不超过 30M
    - Android java heap 不超过 20M
    - 页面切后台后内存存留，java heap 不超过 5M，Native heap 不超过 15M。

- - 存在视频内容

- - - 单页整体内存不超过 70M
    - Native heap 不超过 50M
    - Android java heap 不超过 20M
    - 页面切后台后内存存留，java heap 不超过 5M，Native heap 不超过 30M

- - **页面反复进出内存不升高（**一般来说，占用的内存应该保持在一个水平线上，不会有太大变化，如果一直在增加，则说明可能有内存泄漏问题**）**

- iOS

- - 页面内存增量不超过 40M
  - iPhone7 及以上机型，内存增量在上述基础上可增加 20%（因为其内存有 2G）
  - 页面压栈后出栈，内存可以回到压栈前的水位

#### 4、CPU✨

建议范围：小于等于5

#### 5、嵌套层级✨

嵌套层级过高影响页面的渲染，严重的会增加 crash 风险。通过 Weex Anaylzer 提供的层级检测功能，你可以真实的查看页面的嵌套层级，防止过高层级的出现，超过**标准层级（14 层）**的会高亮显示，颜色越深，层级越高。

### 可使用的工具

#### 1、测试平台：ATS

平台地址：http://ats.alibaba-inc.com/common/index?pageName=createTask

#### 2、手淘：weex-analyzer

https://yuque.antfin-inc.com/weex_analyzer/document/kz8uxs



# 接口测试

### 1 为什么？什么时候？

**一般来说，需要接口测试的情况如下：**

1. 只涉及到后端改造的时候
2. 后端先发、前端隔很久才发
3. 前端出现问题，需要定位原因

**为什么要接口测试？**

- 测试接口的正确性和稳定性；

1. 越底层发现bug，它的修复成本是越低的。
2. 检查系统的安全性、稳定性，前端传参不可信，比如购物，前端价格不可能传入-1元，但是通过接口可以传入-1元。
3. 接口测试**相对容易实现自动化持续集成**，且相对UI自动化也比较稳定，可以减少人工回归测试人力成本与时间，缩短测试周期，提高测试效率看，支持后端快速发版需求。**接口持续集成是为什么能低成本高收益的根源。**
4. 现在很多系统前后端架构是分离的，从安全层面来说：
   1. 只依赖前端进行限制已经完全不能满足系统的安全要求（**绕过前面实在太容易**）， 需要后端同样进行控制，在这种情况下就需要从接口层面进行验证。
   2. 前后端传输、日志打印等信息**是否加密传输**也是需要验证的，特别是涉及到用户的隐私信息，如身份证，银行卡等。

### 2 接口是什么？

可以简单的理解为就是URL，通过get或者post请求向服务器发送一些东西，然后得到一些响应的返回值。

### 3 需要测什么？

- **测试内容：**

  mock客户端，通过URL（接口地址）向服务器发送请求报文，服务器接收请求报文后对相应的报文做处理并向客户端返回应答，查看返回的是不是我们预期结果；

- **重点：**

  检查数据的交换，传递和控制管理过程，还包括处理的次数；

- **核心：**

  持续集成是接口测试的核心；

### 4 接口的分类？

主要分三种：

- http

- hsf

- mtop
- top
- bean

#### http

超文本传输协议，包括get/post等请求

> **get请求，post请求的区别：**
>
> 1、GET使用URL或Cookie传参。而POST将数据放在BODY中。
>
> 2、GET的URL会有长度上的限制，则POST的数据则可以非常大。
>
> 3、POST比GET安全，因为数据在地址栏上不可见。
>
> 4、一般get请求用来获取数据，post请求用来发送数据。
>
> 其实上面这几点，只有最后一点说的是比较靠谱的，第一点post请求也可以把数据放到url里面，get请求其实也没长度限制，post请求看起来参数是隐式的，稍微安全那么一些些，但是那只是对于小白用户来说的，就算post请求，你通过抓包也是可以抓到参数的。（唯一区别就是这一点，上面3点区别都是不准确的）

#### hsf

high speed service framework，是一个RPC框架，接口调用的协议是自定义的，不是标准的http调用，性能可能会好一点，但不够通用

#### mtop

- 概念：

  一个网关（用于无线端）：为了解决无线端需要处理同时调用HTTP和HSF接口，网关还可以承载其他很多功能，负载均衡 流量分发 限流 服务降级 容灾等等。

- 产品官方文档：https://yuque.antfin-inc.com/mtop/doc/intro

- mtop调用超时时间（见下图）： http://gitlab.alibaba-inc.com/mtop/mtop-doc/wikis/mtop-request-timeout

  ![image-20190831164311280](/Users/baola/Library/Application Support/typora-user-images/image-20190831164311280.png)

- mtop访问入口说明：http://gitlab.alibaba-inc.com/mtop/mtop-doc/wikis/mtop-api-entrance

  每个请求都会在url中标注请求来源：

  - H5：一种使用html编写页面的技术
  - 客户端：一般指手机app（无线端）
  - 服务端：具体的后台服务，给无线端页面和H5页面提供具体的服务，也就是接口，再具体一点就是函数调用

- max平台除了进行接口测试，还可以创建api、发布api、进行压测等等（datafront集成了相似的功能）

#### datafront

是拍卖这边构造的一个专门针对接口的平台，接口先通过datafront、然后是通过mtop、然后调用http和hsf接口。

### 5 怎么测？

#### 5.1 需要掌握的知识

①了解系统及内部各个组件之间的业务逻辑交互；

②了解接口的I/O（input/output：输入输出）；

③了解协议的基本内容，包括：通信原理、三次握手、常用的协议类型、报文构成、数据传输方式、常见的状态码、URL构成等；

④常用的接口测试工具，比如：jmeter、loadrunner、postman、soapUI等；

⑤数据库基础操作命令（检查数据入库、提取测试数据等）；

⑥常见的字符类型，比如：char、varchar、text、int、float、datatime、string等；

#### 5.2 接口测试工具

##### 1. MAX平台

平台地址：http://max.m.taobao.com/mtop/myapi?biz_domain=ali

##### 2. DataFront

https://datafront.alibaba-inc.com/datafront#/console/interface/list?page=1&pageSize=10&from=all&s=&appId=11

##### 3. ATP

http://pre-paimai-test.taobao.com/#/autotest/sceneList?page=1&s=&from=

通过配置入参，调用接口获取返回值，然后使用Mvel表达式作为断言方式。

使用MVEL进行可视化配置用例的断言：https://www.atatech.org/articles/102743?spm=ata.13261165.0.0.a46e1d0ecs4FzG



#### 5.3 用例设计重点

- 通常情况下主要测试最外层的两类接口：

  1. 数据进入系统接口（调用外部系统的参数为本系统使用）

  2. 数据流出系统接口（验证系统处理后的数据是否正常）；

     PS：设计用例时还需要注意外部接口提供给使用这些接口的外部用户什么功能，外部用户真正需要什么功能；

- 主要三个方面：

  **基本功能测试**：业务功能、业务规则

  **参数验证：**边界值分、异常场景

  **覆盖率：**接口覆盖率、代码覆盖率

  **性能测试**：这里要注意和前端性能的区分

  ​		主要关注接口响应时间、并发、服务端资源的使用情况

  **安全指标**：

- **接口测试和UI测试的侧重点**

  接口测试关注服务器逻辑验证，UI测试关注页面展示逻辑

#### 5.4 其他相关知识

- **http状态码：**

  ![image-20190831155507832](/Users/baola/Library/Application Support/typora-user-images/image-20190831155507832.png)

  403：没有权限访问这个页面

  504：服务器超时，没有返回结果

- **cookie和session的区别：**

  1、cookie数据存放在客户的浏览器上，session数据放在服务器上。

  2、cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗考虑到安全应当使用session。

  3、session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能考虑到减轻服务器性能方面，应当使用cookie。

  4、单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。

  5、所以建议：

  将登陆信息等重要信息存放为session

  其他信息如果需要保留，可以放在cookie中

### 6 接口自动化

对接口测试而言，持续集成自动化是核心内容，通过持自动化的手段我们才能做到低成本高收益。目前我们已经实现了接口自动化，主要应用于回归阶段，包括但不限于下面的内容：

> a) 流程方面：在回归阶段加强接口异常场景的覆盖度，并逐步向系统测试，冒烟测试阶段延伸，最终达到全流程自动化。
>
> b) 结果展示：更加丰富的结果展示、趋势分析，质量统计和分析等
>
> c) 问题定位：报错信息、日志更精准，方便问题复现与定位。
>
> d) 结果校验：加强自动化校验能力，如数据库信息校验。
>
> e) 代码覆盖率：不断尝试由目前的黑盒向白盒下探，提高代码覆盖率。
>
> f) 性能需求：完善性能测试体系，通过自动化的手段监控接口性能指标是否正常。
>
> 参考文档：https://juejin.im/post/5b4c5518f265da0f6131fb20
>



# 功能测试：UI自动化

### ATP：UI自动化

平台地址：https://paimai-test.taobao.net/#/uiauto/uiCaseList



# 数据库测试

#### 如何做数据开发？包括ODPS、DataStudio、FBI、玄机藏和DeepInsight使用方法

https://www.atatech.org/articles/153685?spm=ata.13269325.0.0.3f8d49faf7TE19

### 数据库：iDB

平台地址：https://idb4.alibaba-inc.com/?spm=ata.13261165.0.0.145476d1DVGxkA

- 权限和环境：

区分生产（线上、预发）和测试（日常）环境。

我们一般只使用查询功能，测试环境的权限申请会自动审批，生产环境的权限需要申请。真正测试的时候，使用生产环境。



- 怎么使用？ 

1. 查数据库：直接搜索数据所在的库和表，点查询

![image-20190909143425855](/Users/baola/Library/Application Support/typora-user-images/image-20190909143425855.png)



1. 通过SQL命令语句来查询。

输入：

```
SELECT * FROM tag_object_0015 WHERE object_id = 2300950446095
```

然后执行

![image-20190909143440465](/Users/baola/Library/Application Support/typora-user-images/image-20190909143440465.png)



【注意】

1. 尽量不要一次查太多数据量（添加查询条件进行限制），不要查一些敏感信息。